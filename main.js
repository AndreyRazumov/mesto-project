(()=>{"use strict";var e=document.querySelector("#template").content,t=document.querySelector(".elements__list"),n=document.querySelector(".popup__image"),o=document.querySelector("#profilePopup"),r=document.querySelector("#cardPopup"),c=document.querySelector("#avatarPopup"),a=document.querySelector("#imagePopup"),u=document.querySelector("#popupCardsName"),i=document.querySelector("#popupCardsImage"),l=document.querySelector("#popupProfileName"),s=document.querySelector("#popupProfileDescription"),d=document.querySelector("#popupAvatarImage"),m=document.querySelector("#cards_button-save"),p=document.querySelector("#avatar_button-save"),f=document.querySelector("#profile_button-save"),v=document.querySelectorAll(".popup"),_=document.querySelector(".profile__name"),h=document.querySelector(".profile__desc"),y=document.querySelector(".profile__button-edit"),b=document.querySelector(".profile__button-link"),S=document.querySelector(".profile__avatar-image"),q=document.querySelector("#profileForm"),L=document.querySelector("#cardForm"),C=document.querySelector("#avatarForm"),g=document.querySelector(".popup__figcaption"),E=document.forms.cardsAdd,k=document.forms.avatarAdd,x={baseUrl:"https://nomoreparties.co/v1/plus-cohort-11",headers:{authorization:"21113fb3-0279-459b-96d2-cacb8e8c5e15","Content-Type":"application/json"}};function A(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function P(e){e.classList.add("popup_opened"),document.addEventListener("keydown",D)}function U(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",D)}function D(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&U(t)}}function T(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.removeAttribute("disabled")):(t.classList.add(n),t.setAttribute("disabled",""))}function B(e){e.classList.contains("button_inactive")||(e.classList.add("button_inactive"),e.setAttribute("disabled",""))}function N(e){var t=e.closest(".element"),n=e.querySelector(".element__button-like-num");e.addEventListener("click",(function(){var o;e.classList.contains("element__button-like_active")?function(e){return fetch("".concat(x.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:x.headers}).then(A)}(t.id).then((function(t){n.textContent=t.likes.length,e.classList.remove("element__button-like_active")})).catch((function(e){return console.log(e)})):(o=t.id,fetch("".concat(x.baseUrl,"/cards/likes/").concat(o),{method:"PUT",headers:x.headers}).then(A)).then((function(t){n.textContent=t.likes.length,e.classList.add("element__button-like_active")})).catch((function(e){return console.log(e)}))}))}function w(e){var t,n,o;t=e.target.closest(".element").id,o=document.getElementById("".concat(t)),(n=t,fetch("".concat(x.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:x.headers})).then((function(){o.remove()})).catch((function(e){return console.log(e)}))}function O(e){var t=e.target,o=t.closest(".element").querySelector(".element__caption").textContent;n.src=t.src,g.textContent=n.alt=o,P(a)}function j(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t._id,c=t.link,a=t.name,u=t.likes,i=e.cloneNode(!0),l=i.querySelector(".element"),s=l.querySelector(".element__image"),d=i.querySelector(".element__caption"),m=i.querySelector(".element__button-trash"),p=i.querySelector(".element__button-like"),f=p.querySelector(".element__button-like-num");return l.id=r,s.src=c,s.alt=a,f.textContent=u.length,d.textContent=a,n?m.addEventListener("click",w):m.classList.add("element__button-trash_inactive"),o&&p.classList.add("element__button-like_active"),s.addEventListener("click",O),N(p),i}var F,I,J,H,z,M,G,K=[fetch("".concat(x.baseUrl,"/users/me"),{headers:x.headers}).then(A),fetch("".concat(x.baseUrl,"/cards"),{headers:x.headers}).then(A)];Promise.all(K).then((function(e){var n,o,r=e[0],c=e[1];_.textContent=r.name,h.textContent=r.about,S.src=r.avatar,n=c,o=r._id,n.forEach((function(e){var n=o===e.owner._id,r=Boolean(e.likes.find((function(e){return e._id===o}))),c=j(e,n,r);t.append(c)}))})).catch((function(e){return console.log(e)})),y.addEventListener("click",(function(){l.value=_.textContent,s.value=h.textContent,P(o)})),b.addEventListener("click",(function(){E.reset(),B(m),P(r)})),S.addEventListener("click",(function(){k.reset(),B(p),P(c)})),v.forEach((function(e){e.addEventListener("mousedown",(function(t){(t.target.classList.contains("popup__button-close")||t.target.classList.contains("popup"))&&U(e)}))})),L.addEventListener("submit",(function(e){var n,o;e.preventDefault(),m.textContent="Сохранение...",(n=u.value,o=i.value,fetch("".concat(x.baseUrl,"/cards"),{method:"POST",headers:x.headers,body:JSON.stringify({name:n,link:o})}).then(A)).then((function(e){var n=j(e);t.prepend(n),U(r)})).catch((function(e){return console.log(e)})).finally((function(){m.textContent="Создать"}))})),q.addEventListener("submit",(function(e){var t,n;e.preventDefault(),f.textContent="Сохранение...",(t=l.value,n=s.value,fetch("".concat(x.baseUrl,"/users/me"),{method:"PATCH",headers:x.headers,body:JSON.stringify({name:t,about:n})}).then(A)).then((function(e){_.textContent=e.name,h.textContent=e.about,U(o)})).catch((function(e){return console.log(e)})).finally((function(){f.textContent="Сохранить"}))})),C.addEventListener("submit",(function(e){var t;e.preventDefault(),p.textContent="Сохранение...",(t=d.value,fetch("".concat(x.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:x.headers,body:JSON.stringify({avatar:t})}).then(A)).then((function(e){S.src=e.avatar,U(c)})).catch((function(e){return console.log(e)})).finally((function(){p.textContent="Сохранить"}))})),I=(F={formSelector:".popup__block",inputSelector:".popup__item",submitButtonSelector:".popup__button-save",inactiveButtonClass:"button_inactive",inputErrorClass:"popup__item_type_error",errorClass:"popup__item-error_active"}).formSelector,J=F.inputSelector,H=F.submitButtonSelector,z=F.inactiveButtonClass,M=F.inputErrorClass,G=F.errorClass,Array.from(document.querySelectorAll(I)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t,n,o,r,c){var a=Array.from(e.querySelectorAll(t)),u=e.querySelector(n);T(a,u,o),a.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,o){t.validity.valid?function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n),r.classList.remove(o),r.textContent=""}(e,t,n,o):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n),c.textContent=o,c.classList.add(r)}(e,t,n,t.validationMessage,o)}(e,t,r,c),T(a,u,o)}))}))}(e,J,H,z,M,G)}))})();